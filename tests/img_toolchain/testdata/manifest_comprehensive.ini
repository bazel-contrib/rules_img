[test]
name = manifest_comprehensive
description = Comprehensive manifest test with environment and labels

[command]
subcommand = manifest
args = --env HOME=/root --env PATH=/usr/local/bin:/usr/bin --label version=1.0 --label maintainer=test --entrypoint /app/server --manifest manifest.json --config config.json
expect_exit = 0

[assert]
file_exists = manifest.json
file_exists = config.json
file_valid_json = manifest.json
file_valid_json = config.json
file_sha256 = config.json, "3fb31b605e4f79b48cdcdcf474f06633d11dba0b6ce631eee73dd6f7523b0b63"
file_sha256 = manifest.json, "62f9a4fbc61c8c7c0aefcdd6c2cce5dfe37fbd4d3f3d544c6c2c984915f038b0"
json_field_exists = manifest.json, schemaVersion
json_field_exists = manifest.json, mediaType
json_field_exists = config.json, architecture
json_field_exists = config.json, os
file_contains = config.json, "HOME=/root"
file_contains = config.json, "PATH=/usr/local/bin:/usr/bin"
file_contains = config.json, "version"
file_contains = config.json, "1.0"
file_contains = config.json, "/app/server"
file_contains = manifest.json, "sha256:3fb31b605e4f79b48cdcdcf474f06633d11dba0b6ce631eee73dd6f7523b0b63"
