[test]
name = layer_comprehensive
description = Comprehensive test of layer creation with metadata and validation

[file]
name = app.txt
This is application content for testing

[file]
name = config.conf
server_port=8080
debug=true

[command]
subcommand = layer
args = --add /app/app.txt=app.txt --add /etc/config.conf=config.conf --metadata layer_meta.json layer.tar.gz
expect_exit = 0

[assert]
file_exists = layer.tar.gz
file_exists = layer_meta.json
file_valid_gzip = layer.tar.gz
file_valid_json = layer_meta.json
file_size_gt = layer.tar.gz, 100
file_sha256 = layer.tar.gz, "a8b9c6ee7623ec55b144ff6342afc84b132329bb0bf6a83c3634c665d8a45b21"
json_field_exists = layer_meta.json, digest
json_field_exists = layer_meta.json, size
json_field_exists = layer_meta.json, mediaType
file_contains = layer_meta.json, "sha256:a8b9c6ee7623ec55b144ff6342afc84b132329bb0bf6a83c3634c665d8a45b21"
