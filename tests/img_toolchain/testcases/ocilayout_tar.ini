[test]
name = ocilayout_tar
description = OCI layout assembly with tar format to create OCI tarball

[file]
name = manifest.json
{
  "schemaVersion": 2,
  "mediaType": "application/vnd.oci.image.manifest.v1+json",
  "config": {
    "mediaType": "application/vnd.oci.image.config.v1+json",
    "size": 1469,
    "digest": "sha256:b5b2b2c5072406148de34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9b2c5"
  },
  "layers": [
    {
      "mediaType": "application/vnd.oci.image.layer.v1.tar+gzip",
      "size": 1024,
      "digest": "sha256:a1a1a1c507240614ade34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9a1a1"
    }
  ]
}

[file]
name = config.json
{
  "architecture": "amd64",
  "os": "linux",
  "config": {
    "Env": ["PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"],
    "Cmd": ["/bin/sh"]
  },
  "rootfs": {
    "type": "layers",
    "diff_ids": [
      "sha256:a1a1a1c507240614ade34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9a1a1"
    ]
  }
}

[file]
name = layer1_metadata.json
{
  "name": "layer1",
  "digest": "sha256:a1a1a1c507240614ade34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9a1a1",
  "size": 1024,
  "mediaType": "application/vnd.oci.image.layer.v1.tar+gzip"
}

[file]
name = layer1.tar.gz
fake layer1 content

[command]
subcommand = oci-layout
args = --manifest manifest.json --config config.json --layer layer1_metadata.json=layer1.tar.gz --format tar --output oci-layout.tar
expect_exit = 0

[assert]
file_exists = oci-layout.tar
file_not_exists = oci-layout.tar/oci-layout
file_not_exists = oci-layout.tar/index.json
# The tar file should have reasonable size (>100 bytes)
file_size_gt = oci-layout.tar, 100
tar_entry_exists = oci-layout.tar, oci-layout
tar_entry_exists = oci-layout.tar, index.json
tar_entry_exists = oci-layout.tar, blobs/
tar_entry_exists = oci-layout.tar, blobs/sha256/
tar_entry_exists = oci-layout.tar, blobs/sha256/a1a1a1c507240614ade34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9a1a1
tar_entry_type = oci-layout.tar, blobs/sha256/a1a1a1c507240614ade34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9a1a1, regular
tar_entry_exists = oci-layout.tar, blobs/sha256/b5b2b2c5072406148de34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9b2c5
tar_entry_type = oci-layout.tar, blobs/sha256/b5b2b2c5072406148de34c2e87b1b0d4e98a8e99e4b1a4d8b48adf2e07f9b2c5, regular
tar_entry_exists = oci-layout.tar, blobs/sha256/e506db6f7420017a5800a9f16dee4192dd4b907249cb1301e431376d50592eb3
tar_entry_type = oci-layout.tar, blobs/sha256/e506db6f7420017a5800a9f16dee4192dd4b907249cb1301e431376d50592eb3, regular
tar_entry_sha256 = oci-layout.tar, blobs/sha256/e506db6f7420017a5800a9f16dee4192dd4b907249cb1301e431376d50592eb3, "e506db6f7420017a5800a9f16dee4192dd4b907249cb1301e431376d50592eb3"
file_sha256 = oci-layout.tar, "8b4b02909387c877d17294faf5d848590db322abb9ae375cb7a2d48ca1f9f109"
