[test]
name = layer_runfiles
description = Test layer creation with regular files in runfiles

[file]
name = foo.exe
#!/bin/sh
echo "Hello World"

[file]
name = data/1.txt
shared content

[file]
name = data/2.txt
shared content

[file]
name = data/3.txt
unique content

[testdata]
copy = runfiles_info=img_toolchain/layer_runfiles/runfiles_info

[command]
subcommand = layer
args = --executable=foo/bar/baz.exe=foo.exe --runfiles=foo.exe=runfiles_info --metadata layer_meta.json layer.tar.gz
expect_exit = 0

[assert]
file_exists = layer.tar.gz
file_size_gt = layer.tar.gz, 0
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe
tar_entry_type = layer.tar.gz, foo/bar/baz.exe, regular
tar_entry_size = layer.tar.gz, foo/bar/baz.exe, 18
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt
tar_entry_type = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt, regular
tar_entry_size = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt, 14
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/2.txt
tar_entry_type = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/2.txt, link
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/3.txt
tar_entry_type = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/3.txt, regular
tar_entry_size = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/3.txt, 14
layer_invariants_intact = layer.tar.gz
file_sha256 = layer_meta.json, "393aa417018dc403ca4b3602bcf65a09cd0e74036104a1507486b15132d6b9df"
file_sha256 = layer.tar.gz, "92a3fca814b3c45e8564335b173b3a1ac355c01dd2bcf5219215f1c0f0d5cb0f"
