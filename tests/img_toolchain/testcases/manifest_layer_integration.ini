[test]
name = manifest_layer_integration
description = Test creating layers and manifests using Ubuntu testdata for realistic integration test

[testdata]
copy = base_config.json=ubuntu/config
copy = base_manifest.json=ubuntu/manifest
copy = sample_blob=ubuntu/blobs/sha256/2abc3421f7c2f72a04e5c749eb23d6d834470cc8e7e2a8b4f4ffb2460a1c92e9

[file]
name = app_layer.txt
Application layer content for testing
Multi-line content to create a realistic layer

[command]
subcommand = layer
args = --add /app/app_layer.txt=app_layer.txt --add /blobs/sample_blob=sample_blob --metadata new_layer.json new_layer.tar.gz
expect_exit = 0

[assert]
file_exists = new_layer.tar.gz
file_exists = new_layer.json
file_valid_gzip = new_layer.tar.gz
file_valid_json = new_layer.json
file_valid_json = base_config.json
file_valid_json = base_manifest.json
file_size_gt = new_layer.tar.gz, 100
json_field_exists = new_layer.json, digest
json_field_exists = new_layer.json, size
json_field_exists = base_config.json, architecture
json_field_exists = base_manifest.json, schemaVersion
