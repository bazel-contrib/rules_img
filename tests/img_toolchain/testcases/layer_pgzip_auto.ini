[test]
name = layer_pgzip_nproc
description = Create a gzip layer using pgzip with nproc jobs

[file]
name = data.txt
This is some test data to compress with pgzip auto jobs.

[command]
subcommand = layer
args = --add /data.txt=data.txt --format gzip --compressor-jobs nproc --compression-level 1 --metadata layer_meta.json layer.tgz
expect_exit = 0

[assert]
file_exists = layer.tgz
file_valid_gzip = layer.tgz
file_exists = layer_meta.json
file_valid_json = layer_meta.json
file_contains = layer_meta.json, "tar+gzip"
tar_entry_exists = layer.tgz, data.txt
tar_entry_type = layer.tgz, data.txt, link
