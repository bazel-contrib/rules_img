[test]
name = layer_tar_assertions
description = Comprehensive test of tar assertion capabilities with CAS structure

[file]
name = app.txt
Application content for testing

[file]
name = script.sh
#!/bin/bash
echo "Hello from script"

[command]
subcommand = layer
args = --add /app/app.txt=app.txt --add /bin/script.sh=script.sh layer.tar.gz
expect_exit = 0

[assert]
file_exists = layer.tar.gz
file_valid_gzip = layer.tar.gz

# Test hardlink entries exist
tar_entry_exists = layer.tar.gz, app/app.txt
tar_entry_type = layer.tar.gz, app/app.txt, link
tar_entry_exists = layer.tar.gz, bin/script.sh
tar_entry_type = layer.tar.gz, bin/script.sh, link

# Test CAS blob entries exist and have correct properties
tar_entry_exists = layer.tar.gz, .cas/blob/bb20d1febe293c5e242410950037ab60b24b29545388d53792607c2487ad0439
tar_entry_type = layer.tar.gz, .cas/blob/bb20d1febe293c5e242410950037ab60b24b29545388d53792607c2487ad0439, regular
tar_entry_size = layer.tar.gz, .cas/blob/bb20d1febe293c5e242410950037ab60b24b29545388d53792607c2487ad0439, 31
tar_entry_sha256 = layer.tar.gz, .cas/blob/bb20d1febe293c5e242410950037ab60b24b29545388d53792607c2487ad0439, "bb20d1febe293c5e242410950037ab60b24b29545388d53792607c2487ad0439"

tar_entry_exists = layer.tar.gz, .cas/blob/a60359fc2fe16b8fac51b9fd0f562c1e7199221718fe23247a126c48110934b9
tar_entry_type = layer.tar.gz, .cas/blob/a60359fc2fe16b8fac51b9fd0f562c1e7199221718fe23247a126c48110934b9, regular
tar_entry_size = layer.tar.gz, .cas/blob/a60359fc2fe16b8fac51b9fd0f562c1e7199221718fe23247a126c48110934b9, 24
tar_entry_sha256 = layer.tar.gz, .cas/blob/a60359fc2fe16b8fac51b9fd0f562c1e7199221718fe23247a126c48110934b9, "a60359fc2fe16b8fac51b9fd0f562c1e7199221718fe23247a126c48110934b9"

# Test that non-existent entries don't exist
tar_entry_not_exists = layer.tar.gz, nonexistent/file.txt
tar_entry_not_exists = layer.tar.gz, .cas/blob/nonexistenthash

# Test file ownership (default is 0:0)
tar_entry_owner = layer.tar.gz, .cas/blob/bb20d1febe293c5e242410950037ab60b24b29545388d53792607c2487ad0439, 0:0
tar_entry_owner = layer.tar.gz, .cas/blob/a60359fc2fe16b8fac51b9fd0f562c1e7199221718fe23247a126c48110934b9, 0:0

# Test file mode (default is 0755 for regular files created by layer tool)
tar_entry_mode = layer.tar.gz, .cas/blob/bb20d1febe293c5e242410950037ab60b24b29545388d53792607c2487ad0439, 0755
tar_entry_mode = layer.tar.gz, .cas/blob/a60359fc2fe16b8fac51b9fd0f562c1e7199221718fe23247a126c48110934b9, 0755
