[test]
name = layer_with_file_metadata
description = Test image_layer with custom file metadata - test JSON-encoded file attributes

[file]
name = app.sh
#!/bin/bash
echo "Hello World"

[file]
name = config.txt
server_port=8080
debug=true

[command]
subcommand = layer
args = --default-metadata {"mode":"0644","uid":1000,"gid":1000,"uname":"appuser","gname":"appgroup"} --file-metadata bin/app.sh={"mode":"0755","uid":0,"gid":0} --file-metadata etc/config.txt={"mode":"0600","uid":0,"gid":0,"uname":"root","gname":"root"} --add bin/app.sh=app.sh --add etc/config.txt=config.txt --metadata layer-meta.json layer.tgz
expect_exit = 0

[assert]
file_exists = layer.tgz
file_exists = layer-meta.json
file_valid_json = layer-meta.json
file_valid_gzip = layer.tgz
file_size_gt = layer.tgz, 10
file_contains = layer-meta.json, "mediaType"
file_contains = layer-meta.json, "sha256:"
