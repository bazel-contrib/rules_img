[test]
name = layer_symlink
description = Test layer creation with a symlink

[file]
name = foo.exe
#!/bin/sh
echo "Hello World"

[file]
name = data/1.txt
42

[testdata]
copy = runfiles_info=img_toolchain/layer_symlink/runfiles_info

[symlinks]
create = link=data

[command]
subcommand = layer
args = --executable=foo/bar/baz.exe=foo.exe --runfiles=foo.exe=runfiles_info --metadata layer_meta.json layer.tar.gz
expect_exit = 0

[assert]
file_exists = layer.tar.gz
file_size_gt = layer.tar.gz, 0
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe
tar_entry_type = layer.tar.gz, foo/bar/baz.exe, regular
tar_entry_size = layer.tar.gz, foo/bar/baz.exe, 18
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt
tar_entry_type = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt, regular
tar_entry_size = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt, 2
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/link
tar_entry_type = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/link, symlink
