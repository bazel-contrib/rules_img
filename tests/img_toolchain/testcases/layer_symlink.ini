[test]
name = layer_symlink
description = Test layer creation with a symlink

[file]
name = foo.exe
#!/bin/sh
echo "Hello World"

[file]
name = data/1.txt
42

[testdata]
copy = runfiles_info=img_toolchain/layer_symlink/runfiles_info

[symlinks]
create = link=data

[command]
subcommand = layer
args = --executable=foo/bar/baz.exe=foo.exe --runfiles=foo.exe=runfiles_info --metadata layer_meta.json layer.tar.gz
expect_exit = 0

[assert]
file_exists = layer.tar.gz
file_size_gt = layer.tar.gz, 0
file_sha256 = layer.tar.gz, "18b33c71f7cbd62af36323e8143a7667f648434a2ae1828757ff67d4e7a14319"
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe
tar_entry_type = layer.tar.gz, foo/bar/baz.exe, link
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt
tar_entry_type = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/data/1.txt, link
tar_entry_exists = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/link
tar_entry_type = layer.tar.gz, foo/bar/baz.exe.runfiles/_main/link, symlink
tar_entry_exists = layer.tar.gz, .cas/blob/3d79dd5f231f248c69eea988ec4384e4444aee108b1df59cab4d77e44dfee147
tar_entry_type = layer.tar.gz, .cas/blob/3d79dd5f231f248c69eea988ec4384e4444aee108b1df59cab4d77e44dfee147, regular
tar_entry_size = layer.tar.gz, .cas/blob/3d79dd5f231f248c69eea988ec4384e4444aee108b1df59cab4d77e44dfee147, 18
tar_entry_exists = layer.tar.gz, .cas/blob/73475cb40a568e8da8a045ced110137e159f890ac4da883b6b17dc651b3a8049
tar_entry_type = layer.tar.gz, .cas/blob/73475cb40a568e8da8a045ced110137e159f890ac4da883b6b17dc651b3a8049, regular
tar_entry_size = layer.tar.gz, .cas/blob/73475cb40a568e8da8a045ced110137e159f890ac4da883b6b17dc651b3a8049, 2
