[test]
name = hash_layer_metadata_gzip
description = Test hash command with layer-metadata encoding on gzip compressed tar

[testdata]
copy = layer.tar.gz=img_toolchain/hash_tests/test_layer.tar.gz

[command]
subcommand = hash
args = --encoding=layer-metadata --name=gzip-layer layer.tar.gz metadata.json
expect_exit = 0

[assert]
file_exists = metadata.json
file_valid_json = metadata.json
json_field_exists = metadata.json, name
json_field_exists = metadata.json, digest
json_field_exists = metadata.json, diff_id
json_field_exists = metadata.json, size
json_field_exists = metadata.json, mediaType
json_field_equals = metadata.json, name, gzip-layer
json_field_equals = metadata.json, mediaType, application/vnd.oci.image.layer.v1.tar+gzip
