[test]
name = layer_comprehensive
description = Comprehensive test of layer creation with metadata and validation

[file]
name = app.txt
This is application content for testing

[file]
name = config.conf
server_port=8080
debug=true

[command]
subcommand = layer
args = --add /app/app.txt=app.txt --add /etc/config.conf=config.conf --metadata layer_meta.json layer.tar.gz
expect_exit = 0

[assert]
file_exists = layer.tar.gz
file_exists = layer_meta.json
file_valid_gzip = layer.tar.gz
file_valid_json = layer_meta.json
file_size_gt = layer.tar.gz, 100
file_sha256 = layer.tar.gz, "3310dfbefb3bdcdd2115811b55f8e75251a80f7f181111aa10df6991f3962287"
json_field_exists = layer_meta.json, digest
json_field_exists = layer_meta.json, size
json_field_exists = layer_meta.json, mediaType
file_contains = layer_meta.json, "sha256:3310dfbefb3bdcdd2115811b55f8e75251a80f7f181111aa10df6991f3962287"
tar_entry_exists = layer.tar.gz, app/app.txt
tar_entry_type = layer.tar.gz, app/app.txt, link
tar_entry_exists = layer.tar.gz, etc/config.conf
tar_entry_type = layer.tar.gz, etc/config.conf, link
tar_entry_exists = layer.tar.gz, .cas/blob/1c96953527852b56805ca5c39c327f01e1065a7bfad7215d5fbee4d1fd4f6be4
tar_entry_type = layer.tar.gz, .cas/blob/1c96953527852b56805ca5c39c327f01e1065a7bfad7215d5fbee4d1fd4f6be4, regular
tar_entry_size = layer.tar.gz, .cas/blob/1c96953527852b56805ca5c39c327f01e1065a7bfad7215d5fbee4d1fd4f6be4, 39
tar_entry_sha256 = layer.tar.gz, .cas/blob/1c96953527852b56805ca5c39c327f01e1065a7bfad7215d5fbee4d1fd4f6be4, "1c96953527852b56805ca5c39c327f01e1065a7bfad7215d5fbee4d1fd4f6be4"
tar_entry_exists = layer.tar.gz, .cas/blob/28c078095f2ebe2f4f11dbf0bb6c758e93799d725898b02fa0c7b44905194159
tar_entry_type = layer.tar.gz, .cas/blob/28c078095f2ebe2f4f11dbf0bb6c758e93799d725898b02fa0c7b44905194159, regular
tar_entry_size = layer.tar.gz, .cas/blob/28c078095f2ebe2f4f11dbf0bb6c758e93799d725898b02fa0c7b44905194159, 27
tar_entry_sha256 = layer.tar.gz, .cas/blob/28c078095f2ebe2f4f11dbf0bb6c758e93799d725898b02fa0c7b44905194159, "28c078095f2ebe2f4f11dbf0bb6c758e93799d725898b02fa0c7b44905194159"
