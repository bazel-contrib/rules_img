[test]
name = layer_parent_directories
description = Test layer creation with parent directory creation enabled

[file]
name = deep.txt
Deep file content

[command]
subcommand = layer
args = --add /very/deep/path/file.txt=deep.txt --create-parent-directories layer.tar.gz
expect_exit = 0

[assert]
file_exists = layer.tar.gz
file_size_gt = layer.tar.gz, 0
file_valid_gzip = layer.tar.gz
# Verify the file itself exists as a regular file
tar_entry_exists = layer.tar.gz, very/deep/path/file.txt
tar_entry_type = layer.tar.gz, very/deep/path/file.txt, regular
tar_entry_size = layer.tar.gz, very/deep/path/file.txt, 17
tar_entry_sha256 = layer.tar.gz, very/deep/path/file.txt, "173b293aafb117acbaff96bc354f2d0f858c9c21b101e35ee5bf36f0e6756a34"
# Verify parent directories are created
tar_entry_type = layer.tar.gz, very/, dir
tar_entry_type = layer.tar.gz, very/deep/, dir
tar_entry_type = layer.tar.gz, very/deep/path/, dir
