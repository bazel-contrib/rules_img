load("@bazel_skylib//:bzl_library.bzl", "bzl_library")
load(":defs.bzl", "os_cpu")

os_cpu(
    name = "target_os_cpu",
    cpu = select({
        "@platforms//cpu:aarch64": "arm64",
        "@platforms//cpu:arm64": "arm64",
        "@platforms//cpu:armv7": "arm",
        "@platforms//cpu:mips64": "mips64",
        "@platforms//cpu:ppc64le": "ppc64le",
        "@platforms//cpu:riscv64": "riscv64",
        "@platforms//cpu:x86_32": "386",
        "@platforms//cpu:x86_64": "amd64",
    }),
    os = select({
        "@platforms//os:android": "android",
        "@platforms//os:freebsd": "freebsd",
        "@platforms//os:ios": "ios",
        "@platforms//os:linux": "linux",
        "@platforms//os:macos": "darwin",
        "@platforms//os:netbsd": "netbsd",
        "@platforms//os:openbsd": "openbsd",
        "@platforms//os:wasi": "wasip1",
        "@platforms//os:windows": "windows",
    }),
    variant = select({
        "//img/constraints/amd64:v1": "v1",
        "//img/constraints/amd64:v2": "v2",
        "//img/constraints/amd64:v3": "v3",
        "//img/constraints/amd64:v4": "v4",
        "//img/constraints/arm:v5": "v5",
        "//img/constraints/arm:v6": "v6",
        "//img/constraints/arm:v7": "v7",
        "//img/constraints/arm:v8": "v8",
        "//img/constraints/arm64:v8.1": "v8.1",
        "//img/constraints/arm64:v8.2": "v8.2",
        "//img/constraints/arm64:v8.3": "v8.3",
        "//img/constraints/arm64:v8.4": "v8.4",
        "//img/constraints/arm64:v8.5": "v8.5",
        "//img/constraints/arm64:v8.6": "v8.6",
        "//img/constraints/arm64:v8.7": "v8.7",
        "//img/constraints/arm64:v8.8": "v8.8",
        "//img/constraints/arm64:v8.9": "v8.9",
        "//img/constraints/arm64:v9": "v9",
        "//img/constraints/arm64:v9.1": "v9.1",
        "//img/constraints/arm64:v9.2": "v9.2",
        "//img/constraints/arm64:v9.3": "v9.3",
        "//img/constraints/arm64:v9.4": "v9.4",
        "//img/constraints/arm64:v9.5": "v9.5",
        "//img/constraints/arm64:v9.6": "v9.6",
        "//img/constraints/arm64:v9.7": "v9.7",
        "//img/constraints:empty_variant": "",
    }),
    visibility = ["//visibility:public"],
)

filegroup(
    name = "all_files",
    srcs = glob(["**"]),
    visibility = ["//img/private/release:__subpackages__"],
)

bzl_library(
    name = "defs",
    srcs = ["defs.bzl"],
    visibility = ["//img:__subpackages__"],
)
